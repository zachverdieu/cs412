<!-- File: templates/thriftiezzz/show_profile.html
 Author: Zacharie Verdieu (zverdieu@bu.edu), 12/8/2025
 Description: Html template for show_profile page for thriftiezzz app
 -->

{% extends "thriftiezzz/base.html" %}

{% block content %}

<div class="profile-detail">

    <!-- ====================== -->
    <!--     PROFILE HEADER     -->
    <!-- ====================== -->

    <div class="profile-header">

        {% if profile.profile_picture %}
            <img src="{{ profile.profile_picture.url }}" alt="{{ profile.username }}" class="profile-detail-image">
        {% else %}
            <div class="profile-detail-image placeholder">No Profile Image</div>
        {% endif %}

        <div class="profile-header-info">

            <h1 class="profile-detail-username">{{ profile.username }}</h1>

            {% if profile.email %}
                <p class="profile-detail-email">{{ profile.email }}</p>
            {% endif %}

            <p class="profile-detail-meta">
                Joined: {{ profile.join_date|date:"M d, Y" }} <br>
                Posts: {{ profile.num_posts }} <br>
                Purchases: {{ profile.num_purchases }}
            </p>

            {% if request.user.is_authenticated and profile.user == request.user %}
                <div class="profile-actions">
                    <a href="{% url 'thriftiezzz:update_profile' profile.pk %}" class="btn btn-primary">Update Profile</a>
                    <a href="{% url 'thriftiezzz:delete_profile' profile.pk %}" class="btn btn-danger">Delete Profile</a>
                    <a href="{% url 'thriftiezzz:show_cart' profile.pk %}" class="btn btn-secondary">View Cart</a>
                </div>
            {% endif %}

        </div>
    </div>


    <!-- ====================== -->
    <!--      USER'S CART       -->
    <!-- ====================== -->

    {% if request.user.is_authenticated and profile.user == request.user %}
        <hr>
        <h2>Your Cart</h2>

        {% with carts=profile.cart_set.all %}
            {% if carts %}
                {% for cart in carts %}
                    {% if cart.clothing_posts.all %}

                        <div class="posts-grid">
                            {% for item in cart.clothing_posts.all %}
                                <div class="post-card">

                                    <!-- CLICKABLE CARD AREA -->
                                    <a href="{% url 'thriftiezzz:show_clothing_post' item.pk %}" class="card-link">

                                        {% if item.picture %}
                                            <img src="{{ item.picture.url }}" alt="{{ item.name }}" class="post-image">
                                        {% else %}
                                            <div class="post-image placeholder">No Image</div>
                                        {% endif %}

                                        <div class="post-info">
                                            <h3 class="post-name">{{ item.name }}</h3>
                                            <p class="post-price">${{ item.price }}</p>
                                            {% if item.is_sold %}
                                                <p class="sold-tag">SOLD</p>
                                            {% endif %}
                                        </div>

                                    </a>

                                </div>
                            {% endfor %}
                        </div>

                    {% else %}
                        <p>Your cart is currently empty.</p>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p>You don't have a cart yet.</p>
            {% endif %}
        {% endwith %}
    {% endif %}



    <!-- ====================== -->
    <!--   POSTS BY THIS USER   -->
    <!-- ====================== -->

    <hr>
    <h2>Posts by {{ profile.username }}</h2>

    {% if profile.clothingpost_set.all %}
        <div class="posts-grid">

            {% for post in profile.clothingpost_set.all %}
                <div class="post-card">

                    <a href="{% url 'thriftiezzz:show_clothing_post' post.pk %}" class="card-link">

                        {% if post.picture %}
                            <img src="{{ post.picture.url }}" alt="{{ post.name }}" class="post-image">
                        {% else %}
                            <div class="post-image placeholder">No Image</div>
                        {% endif %}

                        <div class="post-info">
                            <h3 class="post-name">{{ post.name }}</h3>
                            <p class="post-price">${{ post.price }}</p>

                            {% if post.is_sold %}
                                <p class="sold-tag">SOLD</p>
                            {% endif %}
                        </div>

                    </a>

                </div>
            {% endfor %}

        </div>

    {% else %}
        <p>{{ profile.username }} hasn't posted any items yet.</p>
    {% endif %}



    <!-- ====================== -->
    <!--    PURCHASED POSTS     -->
    <!-- ====================== -->

    <hr>
    <h2>Posts Purchased by {{ profile.username }}</h2>

    {% if profile.buyer.all %}
        <div class="posts-grid">

            {% for purchase in profile.buyer.all %}
                {% with post=purchase.clothing_post %}
                    <div class="post-card">

                        <a href="{% url 'thriftiezzz:show_clothing_post' post.pk %}" class="card-link">

                            {% if post.picture %}
                                <img src="{{ post.picture.url }}" alt="{{ post.name }}" class="post-image">
                            {% else %}
                                <div class="post-image placeholder">No Image</div>
                            {% endif %}

                            <div class="post-info">
                                <h3 class="post-name">{{ post.name }}</h3>
                                <p class="post-price">${{ post.price }}</p>
                                <p class="post-meta">Purchased on: {{ purchase.purchase_date|date:"M d, Y" }}</p>
                            </div>

                        </a>

                    </div>
                {% endwith %}
            {% endfor %}

        </div>

    {% else %}
        <p>{{ profile.username }} has not purchased any items yet.</p>
    {% endif %}

    <hr>
    <h2>Reviews on Items Sold by {{ profile.username }}</h2>

    {% if profile.seller_profile.all %}
        <div class="reviews-list">
            {% for review in profile.seller_profile.all %}
                <div class="review-card">

                    <div class="review-header">
                        <strong>Rating:</strong> {{ review.rating }} / 5
                        <span class="review-date">
                            â€¢ {{ review.review_date|date:"M d, Y" }}
                        </span>
                    </div>

                    {% if review.clothing_post %}
                        <p class="review-item">
                            On item:
                            <a href="{% url 'thriftiezzz:show_clothing_post' review.clothing_post.pk %}">
                                {{ review.clothing_post.name }}
                            </a>
                        </p>
                    {% else %}
                        <p class="review-item">
                            (No specific item linked)
                        </p>
                    {% endif %}

                    <p class="review-author">
                        Review by:
                        {{ review.profile.username }}
                    </p>

                    {% if review.comment %}
                        <p class="review-comment">
                            "{{ review.comment }}"
                        </p>
                    {% endif %}

                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No reviews on this seller's items yet.</p>
    {% endif %}


</div>

{% endblock %}